{% extends "base.html" %}
{% block title %}Import Channels - IPTV Panel{% endblock %}
{% block content %}
<h2 class="mb-4"><i class="bi bi-file-earmark-arrow-up"></i> Import Channels from M3U</h2>

<div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    <strong>Smart 2-Step Import Process:</strong>
    <ol class="mb-0 mt-2">
        <li><strong>Step 1:</strong> Upload your M3U or TXT file - we'll analyze it and detect all attributes</li>
        <li><strong>Step 2:</strong> Map the detected fields to the database - you control exactly what gets imported</li>
    </ol>
</div>

<div class="card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-arrow-right-circle"></i> Step 1: Upload M3U/TXT Content</h5>
    </div>
    <div class="card-body">
        <form method="POST" id="importForm">
            <div class="mb-4">
                <label class="form-label"><strong>Import Method</strong></label>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="import_method" id="method_paste" value="paste" checked autocomplete="off">
                    <label class="btn btn-outline-primary" for="method_paste">
                        <i class="bi bi-clipboard"></i> Paste Content
                    </label>

                    <input type="radio" class="btn-check" name="import_method" id="method_url" value="url" autocomplete="off">
                    <label class="btn btn-outline-primary" for="method_url">
                        <i class="bi bi-cloud-download"></i> Fetch from URL
                    </label>
                </div>
            </div>

            <!-- Paste Content Section -->
            <div class="mb-3" id="paste_section">
                <label class="form-label"><strong>Paste M3U or TXT Content</strong></label>
                <textarea name="m3u_content" id="m3u_content" class="form-control" rows="15"
                    placeholder="#EXTM3U&#10;#EXTINF:-1 tvg-id=&quot;123&quot; tvg-name=&quot;Channel Name&quot; tvg-logo=&quot;logo.png&quot; group-title=&quot;Sports&quot;,Channel Name&#10;http://source.com/stream.m3u8&#10;&#10;OR plain TXT format:&#10;http://source1.com/stream1.m3u8&#10;http://source2.com/stream2.m3u8"></textarea>
                <small class="text-muted">
                    <i class="bi bi-check-circle"></i> Supports: Standard M3U, M3U with custom attributes, and plain TXT (URLs only)
                </small>
            </div>

            <!-- URL Fetch Section -->
            <div class="mb-3" id="url_section" style="display: none;">
                <label class="form-label"><strong>M3U Playlist URL</strong></label>
                <input type="text" name="m3u_url" id="m3u_url" class="form-control"
                    placeholder="http://example.com/get.php?username=user&password=pass&type=m3u&output=ts">
                <small class="text-muted">
                    <i class="bi bi-cloud-download"></i> Enter a URL to an M3U playlist (supports Xtream Codes format)
                </small>
            </div>

            <div class="alert alert-light border">
                <h6><i class="bi bi-lightbulb"></i> Supported Formats:</h6>
                <ul class="mb-0">
                    <li><strong>M3U with attributes:</strong> We'll detect all tvg-id, tvg-name, tvg-logo, group-title, and any custom fields</li>
                    <li><strong>Basic M3U:</strong> Just #EXTINF lines with channel names</li>
                    <li><strong>Plain TXT:</strong> One URL per line (we'll auto-generate names)</li>
                </ul>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success btn-lg">
                    <i class="bi bi-arrow-right-circle"></i> Analyze & Continue to Mapping
                </button>
                <a href="{{ url_for('channels_list') }}" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Toggle between paste and URL import methods
document.addEventListener('DOMContentLoaded', function() {
    const methodPaste = document.getElementById('method_paste');
    const methodUrl = document.getElementById('method_url');
    const pasteSection = document.getElementById('paste_section');
    const urlSection = document.getElementById('url_section');
    const m3uContent = document.getElementById('m3u_content');
    const m3uUrl = document.getElementById('m3u_url');

    function updateVisibility() {
        if (methodPaste.checked) {
            pasteSection.style.display = 'block';
            urlSection.style.display = 'none';
            m3uContent.required = true;
            m3uUrl.required = false;
        } else {
            pasteSection.style.display = 'none';
            urlSection.style.display = 'block';
            m3uContent.required = false;
            m3uUrl.required = true;
        }
    }

    methodPaste.addEventListener('change', updateVisibility);
    methodUrl.addEventListener('change', updateVisibility);

    // Initialize
    updateVisibility();
});
</script>

{% endblock %}
