{% extends "base.html" %}
{% block title %}M3U Sources - IPTV Panel{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-collection"></i> M3U Sources</h2>
    <a href="{{ url_for('channels_import') }}" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Import New M3U
    </a>
</div>

{% if sources %}
    <div class="row">
        {% for source in sources %}
        <div class="col-md-6 mb-4">
            <div class="card {% if source.is_active %}border-success{% endif %}">
                <div class="card-header {% if source.is_active %}bg-success text-white{% else %}bg-secondary text-white{% endif %}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            {% if source.is_active %}
                                <i class="bi bi-check-circle-fill"></i>
                            {% else %}
                                <i class="bi bi-circle"></i>
                            {% endif %}
                            {{ source.name }}
                        </h5>
                        <span class="badge {% if source.is_active %}bg-light text-success{% else %}bg-dark{% endif %}">
                            {% if source.is_active %}ACTIVE{% else %}Inactive{% endif %}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <small class="text-muted">Total Channels</small>
                            <h4>{{ source.total_channels }}</h4>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Uploaded</small>
                            <p class="mb-0">{{ source.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                    </div>

                    {% if source.description %}
                    <p class="text-muted mb-3"><i class="bi bi-info-circle"></i> {{ source.description }}</p>
                    {% endif %}

                    <div class="btn-group w-100" role="group">
                        <a href="{{ url_for('m3u_source_view', source_id=source.id) }}" class="btn btn-outline-primary">
                            <i class="bi bi-eye"></i> View Channels
                        </a>

                        {% if source.is_active %}
                            <form method="POST" action="{{ url_for('m3u_source_deactivate', source_id=source.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-outline-warning"
                                    onclick="return confirm('Deactivate this source? Users will lose access to these channels.')">
                                    <i class="bi bi-pause-circle"></i> Deactivate
                                </button>
                            </form>
                        {% else %}
                            <form method="POST" action="{{ url_for('m3u_source_activate', source_id=source.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-outline-success"
                                    onclick="return confirm('Activate {{ source.name }}? This will deactivate the current source and sync {{ source.total_channels }} channels.')">
                                    <i class="bi bi-play-circle"></i> Activate
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('m3u_source_delete', source_id=source.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-outline-danger"
                                    onclick="return confirm('Delete {{ source.name }} and all {{ source.total_channels }} channels? This cannot be undone.')">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i>
        <strong>No M3U sources yet.</strong>
        <p class="mb-0 mt-2">Import your first M3U playlist to get started. Each M3U you upload will be saved as a separate source that you can activate or switch between.</p>
        <a href="{{ url_for('channels_import') }}" class="btn btn-success mt-3">
            <i class="bi bi-upload"></i> Import Your First M3U
        </a>
    </div>
{% endif %}

<div class="card mt-4">
    <div class="card-header bg-info text-white">
        <h6 class="mb-0"><i class="bi bi-question-circle"></i> How M3U Sources Work</h6>
    </div>
    <div class="card-body">
        <ul class="mb-0">
            <li><strong>Multiple Sources:</strong> You can upload M3U lists from different providers and save them all.</li>
            <li><strong>One Active at a Time:</strong> Only one source can be active. This determines which channels users see in their playlists.</li>
            <li><strong>Easy Switching:</strong> Click "Activate" to instantly switch providers. All channels sync automatically to the streaming server.</li>
            <li><strong>Safe Testing:</strong> Test a new provider without losing your current setup. If it doesn't work, just switch back!</li>
            <li><strong>Source-Specific Categories:</strong> Each source has its own categories. Sports channels from Provider A are separate from Provider B's Sports.</li>
        </ul>
    </div>
</div>
{% endblock %}
